/* jquery.sparkline 2.1.2 - http://omnipotent.net/jquery.sparkline/
** Licensed under the New BSD License - see above site for details */

(function(t,g,k){(function(g){"function"===typeof define&&define.amd?define(["jquery"],g):jQuery&&!jQuery.fn.sparkline&&g(jQuery)})(function(h){var H={},p,B,F,I,E,J,R,S,K,T,U,V,G,W,X,C,L,Y,Z,$,M,N,O,aa,P,Q,y,ba=0;p=function(){var a,b;a=function(){this.init.apply(this,arguments)};1<arguments.length?(arguments[0]?(a.prototype=h.extend(new arguments[0],arguments[arguments.length-1]),a._super=arguments[0].prototype):a.prototype=arguments[arguments.length-1],2<arguments.length&&(b=Array.prototype.slice.call(arguments, 1,-1),b.unshift(a.prototype),h.extend.apply(h,b))):a.prototype=arguments[0];return a.prototype.cls=a};h.SPFormatClass=B=p({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(a,b){this.format=a;this.fclass=b},render:function(a,b,c){var d=this,e,f,z,g,h;return this.format.replace(this.fre,function(m,q,n,s){f=q;z=s;(e=d.precre.exec(f))?(h=e[2],f=e[1]):h=!1;g=a[f];if(g===k)return"";if(z&&b&&b[z])return m=b[z],m.get?b[z].get(g)||g:b[z][g]||g;S(g)&&(g=c.get("numberFormatter")?c.get("numberFormatter")(g): V(g,h,c.get("numberDigitGroupCount"),c.get("numberDigitGroupSep"),c.get("numberDecimalMark")));return g})}});h.spformat=function(a,b){return new B(a,b)};F=function(a,b,c){return a<b?b:a>c?c:a};I=function(a,b){var c;if(2===b)return c=g.floor(a.length/2),a.length%2?a[c]:(a[c-1]+a[c])/2;c=a.length%2?(a.length*b+b)/4:(a.length*b+2)/4;return c%1?(a[g.floor(c)]+a[g.floor(c)-1])/2:a[c-1]};E=function(a){var b;switch(a){case "undefined":a=k;break;case "null":a=null;break;case "true":a=!0;break;case "false":a= !1;break;default:b=parseFloat(a),a==b&&(a=b)}return a};J=function(a){var b,c=[];for(b=a.length;b--;)c[b]=E(a[b]);return c};R=function(a,b){var c,d,e=[];c=0;for(d=a.length;c<d;c++)a[c]!==b&&e.push(a[c]);return e};S=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};V=function(a,b,c,d,e){var f;a=(!1===b?parseFloat(a).toString():a.toFixed(b)).split("");f=0>(f=h.inArray(".",a))?a.length:f;f<a.length&&(a[f]=e);for(b=f-c;0<b;b-=c)a.splice(b,0,d);return a.join("")};K=function(a,b,c){var d;for(d=b.length;d--;)if((!c|| null!==b[d])&&b[d]!==a)return!1;return!0};U=function(a){return h.isArray(a)?a:[a]};T=function(a){var b;t.createStyleSheet?t.createStyleSheet().cssText=a:(b=t.createElement("style"),b.type="text/css",t.getElementsByTagName("head")[0].appendChild(b),b["string"==typeof t.body.style.WebkitAppearance?"innerText":"innerHTML"]=a)};h.fn.simpledraw=function(a,b,c,d){var e;if(c&&(e=this.data("_jqs_vcanvas")))return e;if(!1===h.fn.sparkline.canvas)return!1;if(h.fn.sparkline.canvas===k)if(e=t.createElement("canvas"), e.getContext&&e.getContext("2d"))h.fn.sparkline.canvas=function(a,b,c,d){return new P(a,b,c,d)};else if(t.namespaces&&!t.namespaces.v)t.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),h.fn.sparkline.canvas=function(a,b,c,d){return new Q(a,b,c)};else return h.fn.sparkline.canvas=!1;a===k&&(a=h(this).innerWidth());b===k&&(b=h(this).innerHeight());e=h.fn.sparkline.canvas(a,b,this,d);(a=h(this).data("_jqs_mhandler"))&&a.registerCanvas(e);return e};h.fn.cleardraw=function(){var a=this.data("_jqs_vcanvas"); a&&a.reset()};h.RangeMapClass=G=p({init:function(a){var b,c,d=[];for(b in a)a.hasOwnProperty(b)&&"string"===typeof b&&-1<b.indexOf(":")&&(c=b.split(":"),c[0]=0===c[0].length?-Infinity:parseFloat(c[0]),c[1]=0===c[1].length?Infinity:parseFloat(c[1]),c[2]=a[b],d.push(c));this.map=a;this.rangelist=d||!1},get:function(a){var b=this.rangelist,c,d;if((c=this.map[a])!==k)return c;if(b)for(c=b.length;c--;)if(d=b[c],d[0]<=a&&d[1]>=a)return d[2];return k}});h.range_map=function(a){return new G(a)};W=p({init:function(a, b){this.$el=h(a);this.options=b;this.currentPageY=this.currentPageX=0;this.el=a;this.splist=[];this.tooltip=null;this.over=!1;this.displayTooltips=!b.get("disableTooltips");this.highlightEnabled=!b.get("disableHighlight")},registerSparkline:function(a){this.splist.push(a);this.over&&this.updateDisplay()},registerCanvas:function(a){var b=h(a.canvas);this.canvas=a;this.$canvas=b;b.mouseenter(h.proxy(this.mouseenter,this));b.mouseleave(h.proxy(this.mouseleave,this));b.click(h.proxy(this.mouseclick,this))}, reset:function(a){this.splist=[];this.tooltip&&a&&(this.tooltip.remove(),this.tooltip=k)},mouseclick:function(a){var b=h.Event("sparklineClick");b.originalEvent=a;b.sparklines=this.splist;this.$el.trigger(b)},mouseenter:function(a){h(t.body).unbind("mousemove.jqs");h(t.body).bind("mousemove.jqs",h.proxy(this.mousemove,this));this.over=!0;this.currentPageX=a.pageX;this.currentPageY=a.pageY;this.currentEl=a.target;!this.tooltip&&this.displayTooltips&&(this.tooltip=new X(this.options),this.tooltip.updatePosition(a.pageX, a.pageY));this.updateDisplay()},mouseleave:function(){h(t.body).unbind("mousemove.jqs");var a=this.splist,b=a.length,c=!1,d,e;this.over=!1;this.currentEl=null;this.tooltip&&(this.tooltip.remove(),this.tooltip=null);for(e=0;e<b;e++)d=a[e],d.clearRegionHighlight()&&(c=!0);c&&this.canvas.render()},mousemove:function(a){this.currentPageX=a.pageX;this.currentPageY=a.pageY;this.currentEl=a.target;this.tooltip&&this.tooltip.updatePosition(a.pageX,a.pageY);this.updateDisplay()},updateDisplay:function(){var a= this.splist,b=a.length,c=!1,d=this.$canvas.offset(),e=this.currentPageX-d.left,f=this.currentPageY-d.top,g,k;if(this.over){for(g=0;g<b;g++)d=a[g],(k=d.setRegionHighlight(this.currentEl,e,f))&&(c=!0);if(c){c=h.Event("sparklineRegionChange");c.sparklines=this.splist;this.$el.trigger(c);if(this.tooltip){c="";for(g=0;g<b;g++)d=a[g],c+=d.getCurrentRegionTooltip();this.tooltip.setContent(c)}this.disableHighlight||this.canvas.render()}null===k&&this.mouseleave()}}});X=p({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;", init:function(a){var b=a.get("tooltipClassname","jqstooltip"),c=this.sizeStyle;this.container=a.get("tooltipContainer")||t.body;this.tooltipOffsetX=a.get("tooltipOffsetX",10);this.tooltipOffsetY=a.get("tooltipOffsetY",12);h("#jqssizetip").remove();h("#jqstooltip").remove();this.sizetip=h("<div/>",{id:"jqssizetip",style:c,"class":b});this.tooltip=h("<div/>",{id:"jqstooltip","class":b}).appendTo(this.container);a=this.tooltip.offset();this.offsetLeft=a.left;this.offsetTop=a.top;this.hidden=!0;h(window).unbind("resize.jqs scroll.jqs"); h(window).bind("resize.jqs scroll.jqs",h.proxy(this.updateWindowDims,this));this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=h(window).scrollTop();this.scrollLeft=h(window).scrollLeft();this.scrollRight=this.scrollLeft+h(window).width();this.updatePosition()},getSize:function(a){this.sizetip.html(a).appendTo(this.container);this.width=this.sizetip.width()+1;this.height=this.sizetip.height();this.sizetip.remove()},setContent:function(a){a?(this.getSize(a),this.tooltip.html(a).css({visibility:"visible"}), this.hidden&&(this.hidden=!1,this.updatePosition())):(this.tooltip.css("visibility","hidden"),this.hidden=!0)},updatePosition:function(a,b){if(a===k){if(this.mousex===k)return;a=this.mousex-this.offsetLeft;b=this.mousey-this.offsetTop}else this.mousex=a-=this.offsetLeft,this.mousey=b-=this.offsetTop;this.height&&this.width&&!this.hidden&&(b-=this.height+this.tooltipOffsetY+20,a+=this.tooltipOffsetX-this.width,b<this.scrollTop&&(b=this.scrollTop),a<this.scrollLeft?a=this.scrollLeft:a+this.width>this.scrollRight&& (a=this.scrollRight-this.width),this.tooltip.css({left:a,top:b}))},remove:function(){this.tooltip.remove();this.sizetip.remove();this.sizetip=this.tooltip=k;h(window).unbind("resize.jqs scroll.jqs")}});h(function(){T(".jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background-color: #3a3f44;border-radius: 2px;color: white;text-align: right;white-space: nowrap;padding: 7px 14px;z-index: 10000;}.jqsfield { color: white;font-size: 14;text-align: right;}")});y=[];h.fn.sparkline= function(a,b){return this.each(function(){var c=new h.fn.sparkline.options(this,b),d=h(this),e,f;e=function(){var b,e,f,g;if("html"===a||a===k){b=this.getAttribute(c.get("tagValuesAttribute"));if(b===k||null===b)b=d.html();b=b.replace(/(^\s*\x3c!--)|(--\x3e\s*$)|\s+/g,"").split(",")}else b=a;e="auto"===c.get("width")?b.length*c.get("defaultPixelsPerValue"):c.get("width");"auto"===c.get("height")?c.get("composite")&&h.data(this,"_jqs_vcanvas")||(g=t.createElement("span"),g.innerHTML="a",d.html(g), f=h(g).innerHeight()||h(g).height(),h(g).remove()):f=c.get("height");c.get("disableInteraction")?g=!1:(g=h.data(this,"_jqs_mhandler"))?c.get("composite")||g.reset():(g=new W(this,c),h.data(this,"_jqs_mhandler",g));c.get("composite")&&!h.data(this,"_jqs_vcanvas")?h.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),h.data(this,"_jqs_errnotify",!0)):(f=new (h.fn.sparkline[c.get("type")])(this,b,c,e,f),f.render(),g&&g.registerSparkline(f))}; if(h(this).html()&&!c.get("disableHiddenCheck")&&h(this).is(":hidden")||!h(this).parents("body").length){if(!c.get("composite")&&h.data(this,"_jqs_pending"))for(f=y.length;f;f--)y[f-1][0]==this&&y.splice(f-1,1);y.push([this,e]);h.data(this,"_jqs_pending",!0)}else e.call(this)})};h.fn.sparkline.defaults={common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0, highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:k,normalRangeMax:k,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:k,chartRangeMax:k,chartRangeMinX:k,chartRangeMaxX:k, tooltipFormat:new B("{{prefix}}{{y}}{{suffix}}")},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:"#3366cc #dc3912 #ff9900 #109618 #66aa00 #dd4477 #0099c6 #990099".split(" "),zeroColor:k,nullColor:k,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:k,chartRangeMin:k,chartRangeClip:!1,colorMap:k,tooltipFormat:new B("{{prefix}}{{value}}{{suffix}}")},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new B("{{value:map}}"), tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:k,thresholdValue:0,chartRangeMax:k,chartRangeMin:k,chartRangeClip:!1,tooltipFormat:new B("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:k,tooltipFormat:new B("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:"#3366cc #dc3912 #ff9900 #109618 #66aa00 #dd4477 #0099c6 #990099".split(" "), borderWidth:0,borderColor:"#000",tooltipFormat:new B('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:k,targetColor:"#4a2",chartRangeMax:k,chartRangeMin:k,tooltipFormat:new B("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile", med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}};h.sparkline_display_visible=function(){var a,b,c,d=[];b=0;for(c=y.length;b<c;b++)a=y[b][0],h(a).is(":visible")&&!h(a).parents().is(":hidden")?(y[b][1].call(a),h.data(y[b][0],"_jqs_pending",!1),d.push(b)):h(a).closest("html").length||h.data(a,"_jqs_pending")||(h.data(y[b][0],"_jqs_pending",!1),d.push(b));for(b=d.length;b;b--)y.splice(d[b-1],1)};h.fn.sparkline.options=p({init:function(a,b){var c, d,e;this.userOptions=b=b||{};this.tag=a;this.tagValCache={};c=h.fn.sparkline.defaults;d=c.common;this.tagOptionsPrefix=b.enableTagOptions&&(b.tagOptionsPrefix||d.tagOptionsPrefix);e=this.getTagSetting("type");this.mergedOptions=h.extend({},d,e===H?c[b.type||d.type]:c[e],b)},getTagSetting:function(a){var b=this.tagOptionsPrefix,c,d;if(!1===b||b===k)return H;if(this.tagValCache.hasOwnProperty(a))a=this.tagValCache.key;else{a=this.tag.getAttribute(b+a);if(a===k||null===a)a=H;else if("["===a.substr(0, 1))for(a=a.substr(1,a.length-2).split(","),b=a.length;b--;)a[b]=E(a[b].replace(/(^\s*)|(\s*$)/g,""));else if("{"===a.substr(0,1))for(c=a.substr(1,a.length-2).split(","),a={},b=c.length;b--;)d=c[b].split(":",2),a[d[0].replace(/(^\s*)|(\s*$)/g,"")]=E(d[1].replace(/(^\s*)|(\s*$)/g,""));else a=E(a);this.tagValCache.key=a}return a},get:function(a,b){var c=this.getTagSetting(a),d;return c!==H?c:(d=this.mergedOptions[a])===k?b:d}});h.fn.sparkline._base=p({disabled:!1,init:function(a,b,c,d,e){this.el=a;this.$el= h(a);this.values=b;this.options=c;this.width=d;this.height=e;this.currentRegion=k},initTarget:function(){var a=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),a))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return this.disabled?(this.el.innerHTML="",!1):!0},getRegion:function(a,b){},setRegionHighlight:function(a,b,c){var d=this.currentRegion,e=!this.options.get("disableHighlight"); if(b>this.canvasWidth||c>this.canvasHeight||0>b||0>c)return null;a=this.getRegion(a,b,c);return d!==a?(d!==k&&e&&this.removeHighlight(),this.currentRegion=a,a!==k&&e&&this.renderHighlight(),!0):!1},clearRegionHighlight:function(){return this.currentRegion!==k?(this.removeHighlight(),this.currentRegion=k,!0):!1},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(a){},getCurrentRegionTooltip:function(){var a=this.options, b="",c=[],d,e,f,g,u,l,m,q,n;if(this.currentRegion===k)return"";d=this.getCurrentRegionFields();if(e=a.get("tooltipFormatter"))return e(this,a,d);a.get("tooltipChartTitle")&&(b+='<div class="jqs jqstitle text-semibold text-lg">'+a.get("tooltipChartTitle")+"</div>\n");e=this.options.get("tooltipFormat");if(!e)return"";h.isArray(e)||(e=[e]);h.isArray(d)||(d=[d]);f=this.options.get("tooltipFormatFieldlist");g=this.options.get("tooltipFormatFieldlistKey");if(f&&g){u=[];for(l=d.length;l--;)m=d[l][g],-1!=(n=h.inArray(m, f))&&(u[n]=d[l]);d=u}f=e.length;q=d.length;for(l=0;l<f;l++)for(m=e[l],"string"===typeof m&&(m=new B(m)),g=m.fclass||"jqsfield",n=0;n<q;n++)d[n].isNull&&a.get("tooltipSkipNull")||(h.extend(d[n],{prefix:a.get("tooltipPrefix"),suffix:a.get("tooltipSuffix")}),u=m.render(d[n],a.get("tooltipValueLookups"),a),c.push('<div class="'+g+'">'+u+"</div>"));return c.length?b+c.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(a,b){var c=b.get("highlightColor"),d=b.get("highlightLighten"), e,f,h;if(c)return c;if(d&&(c=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(a)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(a))){f=[];e=4===a.length?16:1;for(h=0;3>h;h++)f[h]=F(g.round(parseInt(c[h+1],16)*e*d),0,255);return"rgb("+f.join(",")+")"}return a}});C={changeHighlight:function(a){var b=this.currentRegion,c=this.target,d=this.regionShapes[b];d&&(a=this.renderRegion(b,a),h.isArray(a)||h.isArray(d)?(c.replaceWithShapes(d,a),this.regionShapes[b]=h.map(a,function(a){return a.id})):(c.replaceWithShape(d, a),this.regionShapes[b]=a.id))},render:function(){var a=this.values,b=this.target,c=this.regionShapes,d,e,f;if(this.cls._super.render.call(this)){for(e=a.length;e--;)if(a=this.renderRegion(e))if(h.isArray(a)){d=[];for(f=a.length;f--;)a[f].append(),d.push(a[f].id);c[e]=d}else a.append(),c[e]=a.id;else c[e]=null;b.render()}}};h.fn.sparkline.line=L=p(h.fn.sparkline._base,{type:"line",init:function(a,b,c,d,e){L._super.init.call(this,a,b,c,d,e);this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues= [];this.yminmax=[];this.lastShapeId=this.hightlightSpotId=null;this.initTarget()},getRegion:function(a,b,c){c=this.regionMap;for(a=c.length;a--;)if(null!==c[a]&&b>=c[a][0]&&b<=c[a][1])return c[a][2];return k},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:null===this.yvalues[a],x:this.xvalues[a],y:this.yvalues[a],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:a}},renderHighlight:function(){var a=this.target,b=this.vertices[this.currentRegion], c=this.options,d=c.get("spotRadius"),e=c.get("highlightSpotColor"),c=c.get("highlightLineColor");b&&(d&&e&&(d=a.drawCircle(b[0],b[1],d,k,e),this.highlightSpotId=d.id,a.insertAfterShape(this.lastShapeId,d)),c&&(b=a.drawLine(b[0],this.canvasTop,b[0],this.canvasTop+this.canvasHeight,c),this.highlightLineId=b.id,a.insertAfterShape(this.lastShapeId,b)))},removeHighlight:function(){var a=this.target;this.highlightSpotId&&(a.removeShapeId(this.highlightSpotId),this.highlightSpotId=null);this.highlightLineId&& (a.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){var a=this.values,b=a.length,c=this.xvalues,d=this.yvalues,e=this.yminmax,f,h,k,l,m;for(f=0;f<b;f++)h=a[f],k="string"===typeof a[f],l="object"===typeof a[f]&&a[f]instanceof Array,m=k&&a[f].split(":"),k&&2===m.length?(c.push(Number(m[0])),d.push(Number(m[1])),e.push(Number(m[1]))):l?(c.push(h[0]),d.push(h[1]),e.push(h[1])):(c.push(f),null===a[f]||"null"===a[f]?d.push(null):(d.push(Number(h)),e.push(Number(h)))); this.options.get("xvalues")&&(c=this.options.get("xvalues"));this.maxy=this.maxyorg=g.max.apply(g,e);this.miny=this.minyorg=g.min.apply(g,e);this.maxx=g.max.apply(g,c);this.minx=g.min.apply(g,c);this.xvalues=c;this.yvalues=d;this.yminmax=e},processRangeOptions:function(){var a=this.options,b=a.get("normalRangeMin"),c=a.get("normalRangeMax");b!==k&&(b<this.miny&&(this.miny=b),c>this.maxy&&(this.maxy=c));a.get("chartRangeMin")!==k&&(a.get("chartRangeClip")||a.get("chartRangeMin")<this.miny)&&(this.miny= a.get("chartRangeMin"));a.get("chartRangeMax")!==k&&(a.get("chartRangeClip")||a.get("chartRangeMax")>this.maxy)&&(this.maxy=a.get("chartRangeMax"));a.get("chartRangeMinX")!==k&&(a.get("chartRangeClipX")||a.get("chartRangeMinX")<this.minx)&&(this.minx=a.get("chartRangeMinX"));a.get("chartRangeMaxX")!==k&&(a.get("chartRangeClipX")||a.get("chartRangeMaxX")>this.maxx)&&(this.maxx=a.get("chartRangeMaxX"))},drawNormalRange:function(a,b,c,d,e){var f=this.options.get("normalRangeMin"),h=this.options.get("normalRangeMax"); b+=g.round(c-(h-this.miny)/e*c);c=g.round(c*(h-f)/e);this.target.drawRect(a,b,d,c,k,this.options.get("normalRangeColor")).append()},render:function(){var a=this.options,b=this.target,c=this.canvasWidth,d=this.canvasHeight,e=this.vertices,f=a.get("spotRadius"),z=this.regionMap,u,l,m,q,n,s,r,x,v,D,p,t,y,A,w;if(L._super.render.call(this)&&(this.scanValues(),this.processRangeOptions(),y=this.xvalues,A=this.yvalues,this.yminmax.length&&!(2>this.yvalues.length))){q=n=0;u=0===this.maxx-this.minx?1:this.maxx- this.minx;l=0===this.maxy-this.miny?1:this.maxy-this.miny;m=this.yvalues.length-1;f&&(c<4*f||d<4*f)&&(f=0);if(f){if((t=a.get("highlightSpotColor")&&!a.get("disableInteraction"))||a.get("minSpotColor")||a.get("spotColor")&&A[m]===this.miny)d-=g.ceil(f);if(t||a.get("maxSpotColor")||a.get("spotColor")&&A[m]===this.maxy)d-=g.ceil(f),q+=g.ceil(f);if(t||(a.get("minSpotColor")||a.get("maxSpotColor"))&&(A[0]===this.miny||A[0]===this.maxy))n+=g.ceil(f),c-=g.ceil(f);if(t||a.get("spotColor")||a.get("minSpotColor")|| a.get("maxSpotColor")&&(A[m]===this.miny||A[m]===this.maxy))c-=g.ceil(f)}d--;a.get("normalRangeMin")===k||a.get("drawNormalOnTop")||this.drawNormalRange(n,q,d,c,l);r=[];x=[r];p=null;t=A.length;for(w=0;w<t;w++)v=y[w],D=y[w+1],s=A[w],v=n+g.round(c/u*(v-this.minx)),D=w<t-1?n+g.round(c/u*(D-this.minx)):c,D=v+(D-v)/2,z[w]=[p||0,D,w],p=D,null===s?w&&(null!==A[w-1]&&(r=[],x.push(r)),e.push(null)):(s<this.miny&&(s=this.miny),s>this.maxy&&(s=this.maxy),r.length||r.push([v,q+d]),s=[v,q+g.round(d-(s-this.miny)/ l*d)],r.push(s),e.push(s));e=[];z=[];p=x.length;for(w=0;w<p;w++)r=x[w],r.length&&(a.get("fillColor")&&(r.push([r[r.length-1][0],q+d]),z.push(r.slice(0)),r.pop()),2<r.length&&(r[0]=[r[0][0],r[1][1]]),e.push(r));p=z.length;for(w=0;w<p;w++)b.drawShape(z[w],a.get("fillColor"),a.get("fillColor")).append();a.get("normalRangeMin")!==k&&a.get("drawNormalOnTop")&&this.drawNormalRange(n,q,d,c,l);p=e.length;for(w=0;w<p;w++)b.drawShape(e[w],a.get("lineColor"),k,a.get("lineWidth")).append();if(f&&a.get("valueSpots"))for(r= a.get("valueSpots"),r.get===k&&(r=new G(r)),w=0;w<t;w++)(x=r.get(A[w]))&&b.drawCircle(n+g.round(c/u*(y[w]-this.minx)),q+g.round(d-(A[w]-this.miny)/l*d),f,k,x).append();f&&a.get("spotColor")&&null!==A[m]&&b.drawCircle(n+g.round(c/u*(y[y.length-1]-this.minx)),q+g.round(d-(A[m]-this.miny)/l*d),f,k,a.get("spotColor")).append();this.maxy!==this.minyorg&&(f&&a.get("minSpotColor")&&(v=y[h.inArray(this.minyorg,A)],b.drawCircle(n+g.round(c/u*(v-this.minx)),q+g.round(d-(this.minyorg-this.miny)/l*d),f,k,a.get("minSpotColor")).append()), f&&a.get("maxSpotColor")&&(v=y[h.inArray(this.maxyorg,A)],b.drawCircle(n+g.round(c/u*(v-this.minx)),q+g.round(d-(this.maxyorg-this.miny)/l*d),f,k,a.get("maxSpotColor")).append()));this.lastShapeId=b.getLastShapeId();this.canvasTop=q;b.render()}}});h.fn.sparkline.bar=Y=p(h.fn.sparkline._base,C,{type:"bar",init:function(a,b,c,d,e){var f=parseInt(c.get("barWidth"),10),z=parseInt(c.get("barSpacing"),10),u=c.get("chartRangeMin"),l=c.get("chartRangeMax"),m=c.get("chartRangeClip"),q=Infinity,n=-Infinity, s,r,x,v,p,t,y;Y._super.init.call(this,a,b,c,d,e);a=0;for(d=b.length;a<d;a++)if(e=b[a],(s="string"===typeof e&&-1<e.indexOf(":"))||h.isArray(e))v=!0,s&&(e=b[a]=J(e.split(":"))),e=R(e,null),s=g.min.apply(g,e),e=g.max.apply(g,e),s<q&&(q=s),e>n&&(n=e);this.stacked=v;this.regionShapes={};this.barWidth=f;this.barSpacing=z;this.totalBarWidth=f+z;this.width=b.length*f+(b.length-1)*z;this.initTarget();m&&(x=u===k?-Infinity:u,r=l===k?Infinity:l);u=[];f=v?[]:u;l=[];z=[];a=0;for(d=b.length;a<d;a++)if(v)for(s= b[a],b[a]=y=[],l[a]=0,p=f[a]=z[a]=0,t=s.length;p<t;p++)e=y[p]=m?F(s[p],x,r):s[p],null!==e&&(0<e&&(l[a]+=e),0>q&&0<n?0>e?z[a]+=g.abs(e):f[a]+=e:f[a]+=g.abs(e-(0>e?n:q)),u.push(e));else e=m?F(b[a],x,r):b[a],e=b[a]=E(e),null!==e&&u.push(e);this.max=m=g.max.apply(g,u);this.min=b=g.min.apply(g,u);this.stackMax=n=v?g.max.apply(g,l):m;this.stackMin=v?g.min.apply(g,u):b;c.get("chartRangeMin")!==k&&(c.get("chartRangeClip")||c.get("chartRangeMin")<b)&&(b=c.get("chartRangeMin"));c.get("chartRangeMax")!==k&& (c.get("chartRangeClip")||c.get("chartRangeMax")>m)&&(m=c.get("chartRangeMax"));this.zeroAxis=q=c.get("zeroAxis",!0);this.xaxisOffset=x=0>=b&&0<=m&&q?0:0==q?b:0<b?b:m;r=v?g.max.apply(g,f)+g.max.apply(g,z):m-b;this.canvasHeightEf=q&&0>b?this.canvasHeight-2:this.canvasHeight-1;b<x?(n=((v&&0<=m?n:m)-x)/r*this.canvasHeight,n!==g.ceil(n)&&(this.canvasHeightEf-=2,n=g.ceil(n))):n=this.canvasHeight;this.yoffset=n;h.isArray(c.get("colorMap"))?(this.colorMapByIndex=c.get("colorMap"),this.colorMapByValue=null): (this.colorMapByIndex=null,(this.colorMapByValue=c.get("colorMap"))&&this.colorMapByValue.get===k&&(this.colorMapByValue=new G(this.colorMapByValue)));this.range=r},getRegion:function(a,b,c){a=g.floor(b/this.totalBarWidth);return 0>a||a>=this.values.length?k:a},getCurrentRegionFields:function(){var a=this.currentRegion,b=U(this.values[a]),c=[],d,e;for(e=b.length;e--;)d=b[e],c.push({isNull:null===d,value:d,color:this.calcColor(e,d,a),offset:a});return c},calcColor:function(a,b,c){var d=this.colorMapByIndex, e=this.colorMapByValue,f=this.options,g,u;g=this.stacked?f.get("stackedBarColor"):0>b?f.get("negBarColor"):f.get("barColor");0===b&&f.get("zeroColor")!==k&&(g=f.get("zeroColor"));e&&(u=e.get(b))?g=u:d&&d.length>c&&(g=d[c]);return h.isArray(g)?g[a%g.length]:g},renderRegion:function(a,b){var c=this.values[a],d=this.options,e=this.xaxisOffset,f=[],z=this.range,u=this.stacked,l=this.target,m=a*this.totalBarWidth,q=this.canvasHeightEf,n=this.yoffset,s,r,x,v,p,t,y,B,c=h.isArray(c)?c:[c];t=c.length;s=K(null, c);B=K(e,c,!0);if(s)return d.get("nullColor")?(x=b?d.get("nullColor"):this.calcHighlightColor(d.get("nullColor"),d),l.drawRect(m,0<n?n-1:n,this.barWidth-1,0,x,x)):k;v=n;for(p=0;p<t;p++){x=c[p];if(u&&x===e){if(!B||y)continue;y=!0}r=0<z?g.floor(q*(g.abs(x-e)/z))+1:1;x<e||x===e&&0===n?(s=v,v+=r):(s=n-r,n-=r);x=this.calcColor(p,x,a);b&&(x=this.calcHighlightColor(x,d));f.push(l.drawRect(m,s,this.barWidth-1,r-1,x,x))}return 1===f.length?f[0]:f}});h.fn.sparkline.tristate=Z=p(h.fn.sparkline._base,C,{type:"tristate", init:function(a,b,c,d,e){var f=parseInt(c.get("barWidth"),10),g=parseInt(c.get("barSpacing"),10);Z._super.init.call(this,a,b,c,d,e);this.regionShapes={};this.barWidth=f;this.barSpacing=g;this.totalBarWidth=f+g;this.values=h.map(b,Number);this.width=b.length*f+(b.length-1)*g;h.isArray(c.get("colorMap"))?(this.colorMapByIndex=c.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,(this.colorMapByValue=c.get("colorMap"))&&this.colorMapByValue.get===k&&(this.colorMapByValue=new G(this.colorMapByValue))); this.initTarget()},getRegion:function(a,b,c){return g.floor(b/this.totalBarWidth)},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===k,value:this.values[a],color:this.calcColor(this.values[a],a),offset:a}},calcColor:function(a,b){var c=this.values,d=this.options,e=this.colorMapByIndex,f=this.colorMapByValue,g;return f&&(g=f.get(a))?g:e&&e.length>b?e[b]:0>c[b]?d.get("negBarColor"):0<c[b]?d.get("posBarColor"):d.get("zeroBarColor")},renderRegion:function(a,b){var c= this.values,d=this.options,e=this.target,f,h,k;f=g.round(e.pixelHeight/2);h=a*this.totalBarWidth;0>c[a]?(k=f,f-=1):0<c[a]?(k=0,f-=1):(k=f-1,f=2);c=this.calcColor(c[a],a);if(null!==c)return b&&(c=this.calcHighlightColor(c,d)),e.drawRect(h,k,this.barWidth-1,f-1,c,c)}});h.fn.sparkline.discrete=$=p(h.fn.sparkline._base,C,{type:"discrete",init:function(a,b,c,d,e){$._super.init.call(this,a,b,c,d,e);this.regionShapes={};this.values=b=h.map(b,Number);this.min=g.min.apply(g,b);this.max=g.max.apply(g,b);this.range= this.max-this.min;this.width=d="auto"===c.get("width")?2*b.length:this.width;this.interval=g.floor(d/b.length);this.itemWidth=d/b.length;c.get("chartRangeMin")!==k&&(c.get("chartRangeClip")||c.get("chartRangeMin")<this.min)&&(this.min=c.get("chartRangeMin"));c.get("chartRangeMax")!==k&&(c.get("chartRangeClip")||c.get("chartRangeMax")>this.max)&&(this.max=c.get("chartRangeMax"));this.initTarget();this.target&&(this.lineHeight="auto"===c.get("lineHeight")?g.round(.3*this.canvasHeight):c.get("lineHeight"))}, getRegion:function(a,b,c){return g.floor(b/this.itemWidth)},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===k,value:this.values[a],offset:a}},renderRegion:function(a,b){var c=this.options,d=this.min,e=this.range,f=this.interval,h=this.target,k=this.lineHeight,l=this.canvasHeight-k,m;m=F(this.values[a],d,this.max);f*=a;d=g.round(l-(m-d)/e*l);m=c.get("thresholdColor")&&m<c.get("thresholdValue")?c.get("thresholdColor"):c.get("lineColor");b&&(m=this.calcHighlightColor(m, c));return h.drawLine(f,d,f,d+k,m)}});h.fn.sparkline.bullet=M=p(h.fn.sparkline._base,{type:"bullet",init:function(a,b,c,d,e){var f;M._super.init.call(this,a,b,c,d,e);this.values=b=J(b);a=b.slice();a[0]=null===a[0]?a[2]:a[0];a[1]=null===b[1]?a[2]:a[1];a=g.min.apply(g,b);f=g.max.apply(g,b);this.min=a=c.get("base")===k?0>a?a:0:c.get("base");this.max=f;this.range=f-a;this.shapes={};this.valueShapes={};this.regiondata={};this.width=d="auto"===c.get("width")?"4.0em":d;this.target=this.$el.simpledraw(d, e,c.get("composite"));b.length||(this.disabled=!0);this.initTarget()},getRegion:function(a,b,c){a=this.target.getShapeAt(a,b,c);return a!==k&&this.shapes[a]!==k?this.shapes[a]:k},getCurrentRegionFields:function(){var a=this.currentRegion;return{fieldkey:a.substr(0,1),value:this.values[a.substr(1)],region:a}},changeHighlight:function(a){var b=this.currentRegion,c=this.valueShapes[b],d;delete this.shapes[c];switch(b.substr(0,1)){case "r":d=this.renderRange(b.substr(1),a);break;case "p":d=this.renderPerformance(a); break;case "t":d=this.renderTarget(a)}this.valueShapes[b]=d.id;this.shapes[d.id]=b;this.target.replaceWithShape(c,d)},renderRange:function(a,b){var c=g.round((this.values[a]-this.min)/this.range*this.canvasWidth),d=this.options.get("rangeColors")[a-2];b&&(d=this.calcHighlightColor(d,this.options));return this.target.drawRect(0,0,c-1,this.canvasHeight-1,d,d)},renderPerformance:function(a){var b=g.round((this.values[1]-this.min)/this.range*this.canvasWidth),c=this.options.get("performanceColor");a&& (c=this.calcHighlightColor(c,this.options));return this.target.drawRect(0,g.round(.3*this.canvasHeight),b-1,g.round(.4*this.canvasHeight)-1,c,c)},renderTarget:function(a){var b=g.round((this.values[0]-this.min)/this.range*this.canvasWidth-this.options.get("targetWidth")/2),c=g.round(.1*this.canvasHeight),d=this.canvasHeight-2*c,e=this.options.get("targetColor");a&&(e=this.calcHighlightColor(e,this.options));return this.target.drawRect(b,c,this.options.get("targetWidth")-1,d-1,e,e)},render:function(){var a= this.values.length,b=this.target,c,d;if(M._super.render.call(this)){for(c=2;c<a;c++)d=this.renderRange(c).append(),this.shapes[d.id]="r"+c,this.valueShapes["r"+c]=d.id;null!==this.values[1]&&(d=this.renderPerformance().append(),this.shapes[d.id]="p1",this.valueShapes.p1=d.id);null!==this.values[0]&&(d=this.renderTarget().append(),this.shapes[d.id]="t0",this.valueShapes.t0=d.id);b.render()}}});h.fn.sparkline.pie=N=p(h.fn.sparkline._base,{type:"pie",init:function(a,b,c,d,e){var f=0;N._super.init.call(this, a,b,c,d,e);this.shapes={};this.valueShapes={};this.values=b=h.map(b,Number);"auto"===c.get("width")&&(this.width=this.height);if(0<b.length)for(a=b.length;a--;)f+=b[a];this.total=f;this.initTarget();this.radius=g.floor(g.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(a,b,c){a=this.target.getShapeAt(a,b,c);return a!==k&&this.shapes[a]!==k?this.shapes[a]:k},getCurrentRegionFields:function(){var a=this.currentRegion;return{isNull:this.values[a]===k,value:this.values[a],percent:this.values[a]/ this.total*100,color:this.options.get("sliceColors")[a%this.options.get("sliceColors").length],offset:a}},changeHighlight:function(a){var b=this.currentRegion;a=this.renderSlice(b,a);var c=this.valueShapes[b];delete this.shapes[c];this.target.replaceWithShape(c,a);this.valueShapes[b]=a.id;this.shapes[a.id]=b},renderSlice:function(a,b){var c=this.target,d=this.options,e=this.radius,f=d.get("borderWidth"),h=d.get("offset"),u=2*g.PI,l=this.values,m=this.total,q=h?h/360*g.PI*2:0,n,s,r;r=l.length;for(s= 0;s<r;s++){n=h=q;0<m&&(n=q+l[s]/m*u);if(a===s)return u=d.get("sliceColors")[s%d.get("sliceColors").length],b&&(u=this.calcHighlightColor(u,d)),c.drawPieSlice(e,e,e-f,h,n,k,u);q=n}},render:function(){var a=this.target,b=this.values,c=this.options,d=this.radius,e=c.get("borderWidth");if(N._super.render.call(this)){e&&a.drawCircle(d,d,g.floor(d-e/2),c.get("borderColor"),k,e).append();for(d=b.length;d--;)b[d]&&(c=this.renderSlice(d).append(),this.valueShapes[d]=c.id,this.shapes[c.id]=d);a.render()}}}); h.fn.sparkline.box=O=p(h.fn.sparkline._base,{type:"box",init:function(a,b,c,d,e){O._super.init.call(this,a,b,c,d,e);this.values=h.map(b,Number);this.width="auto"===c.get("width")?"4.0em":d;this.initTarget();this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var a=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];this.loutlier!==k&&a.push({field:"lo",value:this.loutlier});this.routlier!== k&&a.push({field:"ro",value:this.routlier});this.lwhisker!==k&&a.push({field:"lw",value:this.lwhisker});this.rwhisker!==k&&a.push({field:"rw",value:this.rwhisker});return a},render:function(){var a=this.target,b=this.values,c=b.length,d=this.options,e=this.canvasWidth,f=this.canvasHeight,h=d.get("chartRangeMin")===k?g.min.apply(g,b):d.get("chartRangeMin"),u=d.get("chartRangeMax")===k?g.max.apply(g,b):d.get("chartRangeMax"),l=0,m,q,n,s,r,p,v,t;if(O._super.render.call(this)){if(d.get("raw"))d.get("showOutliers")&& 5<b.length?(q=b[0],m=b[1],s=b[2],r=b[3],p=b[4],v=b[5],t=b[6]):(m=b[0],s=b[1],r=b[2],p=b[3],v=b[4]);else if(b.sort(function(a,b){return a-b}),s=I(b,1),r=I(b,2),p=I(b,3),n=p-s,d.get("showOutliers")){m=v=k;for(q=0;q<c;q++)m===k&&b[q]>s-n*d.get("outlierIQR")&&(m=b[q]),b[q]<p+n*d.get("outlierIQR")&&(v=b[q]);q=b[0];t=b[c-1]}else m=b[0],v=b[c-1];this.quartiles=[s,r,p];this.lwhisker=m;this.rwhisker=v;this.loutlier=q;this.routlier=t;b=e/(u-h+1);d.get("showOutliers")&&(l=g.ceil(d.get("spotRadius")),e-=2*g.ceil(d.get("spotRadius")), b=e/(u-h+1),q<m&&a.drawCircle((q-h)*b+l,f/2,d.get("spotRadius"),d.get("outlierLineColor"),d.get("outlierFillColor")).append(),t>v&&a.drawCircle((t-h)*b+l,f/2,d.get("spotRadius"),d.get("outlierLineColor"),d.get("outlierFillColor")).append());a.drawRect(g.round((s-h)*b+l),g.round(.1*f),g.round((p-s)*b),g.round(.8*f),d.get("boxLineColor"),d.get("boxFillColor")).append();a.drawLine(g.round((m-h)*b+l),g.round(f/2),g.round((s-h)*b+l),g.round(f/2),d.get("lineColor")).append();a.drawLine(g.round((m-h)*b+ l),g.round(f/4),g.round((m-h)*b+l),g.round(f-f/4),d.get("whiskerColor")).append();a.drawLine(g.round((v-h)*b+l),g.round(f/2),g.round((p-h)*b+l),g.round(f/2),d.get("lineColor")).append();a.drawLine(g.round((v-h)*b+l),g.round(f/4),g.round((v-h)*b+l),g.round(f-f/4),d.get("whiskerColor")).append();a.drawLine(g.round((r-h)*b+l),g.round(.1*f),g.round((r-h)*b+l),g.round(.9*f),d.get("medianColor")).append();d.get("target")&&(e=g.ceil(d.get("spotRadius")),a.drawLine(g.round((d.get("target")-h)*b+l),g.round(f/ 2-e),g.round((d.get("target")-h)*b+l),g.round(f/2+e),d.get("targetColor")).append(),a.drawLine(g.round((d.get("target")-h)*b+l-e),g.round(f/2),g.round((d.get("target")-h)*b+l+e),g.round(f/2),d.get("targetColor")).append());a.render()}}});aa=p({init:function(a,b,c,d){this.target=a;this.id=b;this.type=c;this.args=d},append:function(){this.target.appendShape(this);return this}});C=p({_pxregex:/(\d+)(px)?\s*$/i,init:function(a,b,c){a&&(this.width=a,this.height=b,this.target=c,this.lastShapeId=null,c[0]&& (c=c[0]),h.data(c,"_jqs_vcanvas",this))},drawLine:function(a,b,c,d,e,f){return this.drawShape([[a,b],[c,d]],e,f)},drawShape:function(a,b,c,d){return this._genShape("Shape",[a,b,c,d])},drawCircle:function(a,b,c,d,e,f){return this._genShape("Circle",[a,b,c,d,e,f])},drawPieSlice:function(a,b,c,d,e,f,g){return this._genShape("PieSlice",[a,b,c,d,e,f,g])},drawRect:function(a,b,c,d,e,f){return this._genShape("Rect",[a,b,c,d,e,f])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId}, reset:function(){alert("reset not implemented")},_insert:function(a,b){h(b).html(a)},_calculatePixelDims:function(a,b,c){this.pixelHeight=(b=this._pxregex.exec(b))?b[1]:h(c).height();this.pixelWidth=(b=this._pxregex.exec(a))?b[1]:h(c).width()},_genShape:function(a,b){var c=ba++;b.unshift(c);return new aa(this,c,a,b)},appendShape:function(a){alert("appendShape not implemented")},replaceWithShape:function(a,b){alert("replaceWithShape not implemented")},insertAfterShape:function(a,b){alert("insertAfterShape not implemented")}, removeShapeId:function(a){alert("removeShapeId not implemented")},getShapeAt:function(a,b,c){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}});P=p(C,{init:function(a,b,c,d){P._super.init.call(this,a,b,c);this.canvas=t.createElement("canvas");c[0]&&(c=c[0]);h.data(c,"_jqs_vcanvas",this);h(this.canvas).css({display:"inline-block",width:a,height:b,verticalAlign:"top"});this._insert(this.canvas,c);this._calculatePixelDims(a,b,this.canvas);this.canvas.width=this.pixelWidth; this.canvas.height=this.pixelHeight;this.interact=d;this.shapes={};this.shapeseq=[];this.currentTargetShapeId=k;h(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(a,b,c){var d=this.canvas.getContext("2d");a!==k&&(d.strokeStyle=a);d.lineWidth=c===k?1:c;b!==k&&(d.fillStyle=b);return d},reset:function(){this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight);this.shapes={};this.shapeseq=[];this.currentTargetShapeId=k},_drawShape:function(a,b,c,d,e){e= this._getContext(c,d,e);var f,g;e.beginPath();e.moveTo(b[0][0]+.5,b[0][1]+.5);f=1;for(g=b.length;f<g;f++)e.lineTo(b[f][0]+.5,b[f][1]+.5);c!==k&&e.stroke();d!==k&&e.fill();this.targetX!==k&&this.targetY!==k&&e.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a)},_drawCircle:function(a,b,c,d,e,f,h){h=this._getContext(e,f,h);h.beginPath();h.arc(b,c,d,0,2*g.PI,!1);this.targetX!==k&&this.targetY!==k&&h.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a);e!==k&&h.stroke(); f!==k&&h.fill()},_drawPieSlice:function(a,b,c,d,e,f,g,h){var l=this._getContext(g,h);l.beginPath();l.moveTo(b,c);l.arc(b,c,d,e,f,!1);l.lineTo(b,c);l.closePath();g!==k&&l.stroke();h&&l.fill();this.targetX!==k&&this.targetY!==k&&l.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=a)},_drawRect:function(a,b,c,d,e,f,g){return this._drawShape(a,[[b,c],[b+d,c],[b+d,c+e],[b,c+e],[b,c]],f,g)},appendShape:function(a){this.shapes[a.id]=a;this.shapeseq.push(a.id);return this.lastShapeId=a.id}, replaceWithShape:function(a,b){var c=this.shapeseq,d;this.shapes[b.id]=b;for(d=c.length;d--;)c[d]==a&&(c[d]=b.id);delete this.shapes[a]},replaceWithShapes:function(a,b){var c=this.shapeseq,d={},e,f,g;for(f=a.length;f--;)d[a[f]]=!0;for(f=c.length;f--;)e=c[f],d[e]&&(c.splice(f,1),delete this.shapes[e],g=f);for(f=b.length;f--;)c.splice(g,0,b[f].id),this.shapes[b[f].id]=b[f]},insertAfterShape:function(a,b){var c=this.shapeseq,d;for(d=c.length;d--;)if(c[d]===a){c.splice(d+1,0,b.id);this.shapes[b.id]=b; break}},removeShapeId:function(a){var b=this.shapeseq,c;for(c=b.length;c--;)if(b[c]===a){b.splice(c,1);break}delete this.shapes[a]},getShapeAt:function(a,b,c){this.targetX=b;this.targetY=c;this.render();return this.currentTargetShapeId},render:function(){var a=this.shapeseq,b=this.shapes,c=a.length,d,e;this._getContext().clearRect(0,0,this.pixelWidth,this.pixelHeight);for(e=0;e<c;e++)d=a[e],d=b[d],this["_draw"+d.type].apply(this,d.args);this.interact||(this.shapes={},this.shapeseq=[])}});Q=p(C,{init:function(a, b,c){Q._super.init.call(this,a,b,c);c[0]&&(c=c[0]);h.data(c,"_jqs_vcanvas",this);this.canvas=t.createElement("span");h(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:a,height:b,margin:"0px",padding:"0px",verticalAlign:"top"});this._insert(this.canvas,c);this._calculatePixelDims(a,b,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;this.canvas.insertAdjacentHTML("beforeEnd",'<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+ " "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>');this.group=h(this.canvas).children()[0];this.rendered=!1;this.prerender=""},_drawShape:function(a,b,c,d,e){var f=[],g,h;h=0;for(g=b.length;h<g;h++)f[h]=""+b[h][0]+","+b[h][1];b=f.splice(0,1);e=e===k?1:e;c=c===k?' stroked="false" ':' strokeWeight="'+e+'px" strokeColor="'+c+'" ';d=d===k?' filled="false"':' fillColor="'+d+'" filled="true" ';e=f[0]===f[f.length-1]?"x ": "";return'<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" id="jqsshape'+a+'" '+c+d+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;" path="m '+b+" l "+f.join(", ")+" "+e+'e"> </v:shape>'},_drawCircle:function(a,b,c,d,e,f,g){return'<v:oval id="jqsshape'+a+'" '+(e===k?' stroked="false" ':' strokeWeight="'+g+'px" strokeColor="'+e+'" ')+(f===k?' filled="false"':' fillColor="'+f+'" filled="true" ')+ ' style="position:absolute;top:'+(c-d)+"px; left:"+(b-d)+"px; width:"+2*d+"px; height:"+2*d+'px"></v:oval>'},_drawPieSlice:function(a,b,c,d,e,f,h,p){var l,m,q,n;if(e===f)return"";f-e===2*g.PI&&(e=0,f=2*g.PI);l=b+g.round(g.cos(e)*d);m=c+g.round(g.sin(e)*d);q=b+g.round(g.cos(f)*d);n=c+g.round(g.sin(f)*d);if(l===q&&m===n){if(f-e<g.PI)return"";l=q=b+d;m=n=c}return l===q&&m===n&&f-e<g.PI?"":'<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" id="jqsshape'+a+'" '+(h===k?' stroked="false" ': ' strokeWeight="1px" strokeColor="'+h+'" ')+(p===k?' filled="false"':' fillColor="'+p+'" filled="true" ')+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;" path="m '+b+","+c+" wa "+[b-d,c-d,b+d,c+d,l,m,q,n].join(", ")+' x e"> </v:shape>'},_drawRect:function(a,b,c,d,e,f,g){return this._drawShape(a,[[b,c],[b,c+e],[b+d,c+e],[b+d,c],[b,c]],f,g)},reset:function(){this.group.innerHTML=""},appendShape:function(a){var b=this["_draw"+ a.type].apply(this,a.args);this.rendered?this.group.insertAdjacentHTML("beforeEnd",b):this.prerender+=b;return this.lastShapeId=a.id},replaceWithShape:function(a,b){var c=h("#jqsshape"+a),d=this["_draw"+b.type].apply(this,b.args);c[0].outerHTML=d},replaceWithShapes:function(a,b){var c=h("#jqsshape"+a[0]),d="",e=b.length,f;for(f=0;f<e;f++)d+=this["_draw"+b[f].type].apply(this,b[f].args);c[0].outerHTML=d;for(f=1;f<a.length;f++)h("#jqsshape"+a[f]).remove()},insertAfterShape:function(a,b){var c=h("#jqsshape"+ a),d=this["_draw"+b.type].apply(this,b.args);c[0].insertAdjacentHTML("afterEnd",d)},removeShapeId:function(a){a=h("#jqsshape"+a);this.group.removeChild(a[0])},getShapeAt:function(a,b,c){return a.id.substr(8)},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})})})(document,Math);
